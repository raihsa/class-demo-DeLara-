<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>iDecide</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    main {
      width: 420px;
      background: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
    }

    h2, p {
      margin: 6px 0 14px;
      color: #333;
    }

    /* Inputs centered and with consistent width */
    .center-input {
      width: 86%;
      padding: 10px;
      margin: 8px auto;
      display: block;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      text-align: center;
    }

    textarea.center-input {
      height: 90px;
      resize: none;
      text-align: center;
    }

    .small-note {
      font-size: 13px;
      color: #666;
      margin-top: 6px;
    }

    button {
      width: 86%;
      padding: 10px;
      margin: 10px auto;
      display: block;
      border-radius: 6px;
      border: none;
      background: #007bff;
      color: white;
      font-size: 15px;
      cursor: pointer;
    }
    button:hover { opacity: 0.95; }

    .submit-btn { background: #28a745; }
    .back-btn { background: #dc3545; }

    .poll-item {
      background: #fafafa;
      border: 1px solid #eee;
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 10px;
      text-align: center;
    }

    .link {
      color: #007bff;
      cursor: pointer;
      text-decoration: underline;
      display: inline-block;
      margin-top: 8px;
    }

    /* show-password checkbox row */
    .show-row {
      width: 86%;
      margin: 0 auto 8px;
      text-align: left;
      font-size: 13px;
      color: #444;
    }
    .show-row input { vertical-align: middle; margin-right:6px; }
    .success { color: green; font-weight: bold; margin-top:8px; }

    /* Buttons inside poll listings */
    .poll-item button { width: auto; padding: 6px 10px; margin: 6px 6px 0 0; }
  </style>
</head>
<body>
  <main>
    <!-- STUDENT LOGIN -->
    <section id="studentLogin">
      <h2>iDecide</h2>
      <p>Student Login</p>

      <input class="center-input" type="text" id="studentID" maxlength="6" placeholder="School ID (6 digits)">
      <input class="center-input" type="password" id="studentPass" maxlength="8" placeholder="Birthday (MMDDYYYY)">
      <div class="show-row">
        <label><input id="showStudentPass" type="checkbox" onchange="toggleStudentPassword()"> Show password</label>
      </div>

      <button onclick="studentLogin()">Login</button>

      <p><span class="link" onclick="showAdminLogin()">Admin login</span></p>
    </section>

    <!-- ADMIN LOGIN -->
    <section id="adminLogin" style="display:none;">
      <h2>Admin Login</h2>

      <input class="center-input" type="text" id="adminUser" placeholder="Admin username">
      <input class="center-input" type="password" id="adminPass" placeholder="Admin password">
      <div class="show-row">
        <label><input id="showAdminPass" type="checkbox" onchange="toggleAdminPassword()"> Show password</label>
      </div>

      <button onclick="adminLogin()">Login</button>
      <p><span class="link" onclick="backToStudent()">Back to Student Login</span></p>
    </section>

   <!-- ADMIN PAGE -->
<section id="adminPage" style="display:none;">
  <h2>Admin Panel</h2>

  <h3>Create Poll</h3>
  <input class="center-input" type="text" id="pollQuestion" placeholder="Enter question">
  <textarea class="center-input" id="pollOptions" placeholder="Enter options (one per line)"></textarea>
  <button class="submit-btn" onclick="createPoll()">Create Poll</button>

  <h3>All Polls</h3>

  <!--  Search bar for filtering polls -->
  <input 
    class="center-input" 
    type="text" 
    id="searchPoll" 
    placeholder="Search polls by question..." 
    onkeyup="searchPolls()" 
  />

  <div id="pollList"></div>

  <button onclick="logout()">Logout</button>
</section>

    <!-- VOTING PAGE -->
    <section id="votePage" style="display:none;">
      <h2 id="voteQuestion"></h2>
      <input class="center-input" type="text" id="voterName" placeholder="Enter your name">
      <div id="optionButtons" style="margin-top:8px;"></div>
      <button class="submit-btn" onclick="submitVote()">Submit Vote</button>
      <button class="back-btn" onclick="goBack()">Back</button>
      <p id="voteMessage" class="success"></p>
    </section>

    <!-- RESULTS PAGE -->
    <section id="resultsPage" style="display:none;">
      <h2 id="resultsQuestion"></h2>
      <div id="resultsContainer"></div>
      <button onclick="goHome()">Back</button>
    </section>
  </main>

  <script>
  // Simple Voting System (student-level)
  let polls = JSON.parse(localStorage.getItem("polls")) || [];
  let currentPoll = null;
  let selectedOption = null;
  let currentUser = null;

  // Toggle password visibility for student
  function toggleStudentPassword() {
    const p = document.getElementById("studentPass");
    p.type = document.getElementById("showStudentPass").checked ? "text" : "password";
  }

  // Toggle password visibility for admin
  function toggleAdminPassword() {
    const p = document.getElementById("adminPass");
    p.type = document.getElementById("showAdminPass").checked ? "text" : "password";
  }

  function showAdminLogin() {
    document.getElementById("studentLogin").style.display = "none";
    document.getElementById("adminLogin").style.display = "block";
  }

  function backToStudent() {
    document.getElementById("adminLogin").style.display = "none";
    document.getElementById("studentLogin").style.display = "block";
  }

  // Student login with limits (6-digit ID, 8-char pass)
  function studentLogin() {
    const id = document.getElementById("studentID").value.trim();
    const pass = document.getElementById("studentPass").value.trim();

    if (id.length !== 6 || isNaN(id)) {
      alert("School ID must be exactly 6 digits.");
      return;
    }
    if (pass.length !== 8) {
      alert("Password must be exactly 8 characters (MMDDYYYY).");
      return;
    }

    currentUser = id;
    alert("Welcome, Student ID: " + id);
    document.getElementById("studentLogin").style.display = "none";
    document.getElementById("studentPage").style.display = "block";
    loadStudentPolls();
  }

  // Admin login (fixed credentials)
  function adminLogin() {
    const user = document.getElementById("adminUser").value.trim();
    const pass = document.getElementById("adminPass").value.trim();
    if (user === "admin" && pass === "admin123") {
      alert("Welcome, Admin!");
      document.getElementById("adminLogin").style.display = "none";
      document.getElementById("adminPage").style.display = "block";
      loadPolls();
    } else {
      alert("Invalid admin credentials.");
    }
  }

  function logout() {
    currentUser = null;
    selectedOption = null;
    currentPoll = null;

    // reset UI to login
    document.getElementById("studentLogin").style.display = "block";
    document.getElementById("adminLogin").style.display = "none";
    document.getElementById("adminPage").style.display = "none";
    document.getElementById("studentPage").style.display = "none";
    document.getElementById("votePage").style.display = "none";
    document.getElementById("resultsPage").style.display = "none";

    document.getElementById("showStudentPass").checked = false;
    document.getElementById("showAdminPass").checked = false;
    toggleStudentPassword();
    toggleAdminPassword();
  }

  // Admin creates poll
  function createPoll() {
    const q = document.getElementById("pollQuestion").value.trim();
    const optsText = document.getElementById("pollOptions").value.trim();
    if (!q || !optsText) {
      alert("Please complete all fields.");
      return;
    }
    const opts = optsText.split("\n").map(s => s.trim()).filter(s => s);
    const poll = { question: q, options: opts.map(o => ({ name: o, votes: 0 })), voters: [] };
    polls.push(poll);
    localStorage.setItem("polls", JSON.stringify(polls));
    document.getElementById("pollQuestion").value = "";
    document.getElementById("pollOptions").value = "";
    loadPolls();
    alert("Poll created successfully!");
  }

  // Load polls for admin
  function loadPolls() {
    const list = document.getElementById("pollList");
    list.innerHTML = "";
    if (polls.length === 0) {
      list.innerHTML = "<p>No polls yet.</p>";
      return;
    }
    polls.forEach((p, i) => {
      const d = document.createElement("div");
      d.className = "poll-item";
      d.innerHTML = `
        <strong>${p.question}</strong><br>
        <button onclick="viewResults(${i})">View Results</button>
        <button onclick="editPoll(${i})">Edit</button>
        <button onclick="deletePoll(${i})">Delete</button>
      `;
      list.appendChild(d);
    });
  }

  //  Edit poll (admin)
  function editPoll(i) {
    const poll = polls[i];

    // Prompt admin for new question
    const newQuestion = prompt("Edit question:", poll.question);
    if (newQuestion === null || newQuestion.trim() === "") return;

    // Prompt admin for new options (comma-separated)
    const newOptionsText = prompt(
      "Edit options (separate by commas):",
      poll.options.map(o => o.name).join(", ")
    );
    if (newOptionsText === null || newOptionsText.trim() === "") return;

    const newOptions = newOptionsText.split(",").map(o => o.trim()).filter(o => o);

    polls[i].question = newQuestion;
    polls[i].options = newOptions.map(opt => ({ name: opt, votes: 0 }));
    localStorage.setItem("polls", JSON.stringify(polls));

    alert("Poll updated successfully!");
    loadPolls();
  }

  // Search polls by question (Admin)
function searchPolls() {
  const query = document.getElementById("searchPoll").value.toLowerCase();
  const list = document.getElementById("pollList");
  list.innerHTML = "";

  const filtered = polls.filter(p => p.question.toLowerCase().includes(query));

  if (filtered.length === 0) {
    list.innerHTML = "<p>No matching polls found.</p>";
    return;
  }

  filtered.forEach((p, i) => {
    const d = document.createElement("div");
    d.className = "poll-item";
    // We need the correct index from 'polls' array
    const realIndex = polls.indexOf(p);
    d.innerHTML = `
      <strong>${p.question}</strong><br>
      <button onclick="viewResults(${realIndex})">View Results</button>
      <button onclick="editPoll(${realIndex})">Edit</button>
      <button onclick="deletePoll(${realIndex})">Delete</button>
    `;
    list.appendChild(d);
  });
}

  function deletePoll(i) {
    if (!confirm("Delete this poll?")) return;
    polls.splice(i, 1);
    localStorage.setItem("polls", JSON.stringify(polls));
    loadPolls();
  }

  // Student poll list
  function loadStudentPolls() {
    const list = document.getElementById("studentPolls");
    list.innerHTML = "";
    if (polls.length === 0) {
      list.innerHTML = "<p>No active polls right now.</p>";
      return;
    }
    polls.forEach((p, i) => {
      const d = document.createElement("div");
      d.className = "poll-item";
      d.innerHTML = `
        <strong>${p.question}</strong><br>
        <button onclick="openPoll(${i})">Vote</button>
      `;
      list.appendChild(d);
    });
  }

  // Open poll to vote
  function openPoll(i) {
    currentPoll = i;
    selectedOption = null;
    const poll = polls[i];
    document.getElementById("studentPage").style.display = "none";
    document.getElementById("votePage").style.display = "block";
    document.getElementById("voteQuestion").textContent = poll.question;
    document.getElementById("voteMessage").textContent = "";

    const container = document.getElementById("optionButtons");
    container.innerHTML = "";
    poll.options.forEach((opt, idx) => {
      const btn = document.createElement("button");
      btn.className = "vote-btn";
      btn.textContent = opt.name;
      btn.onclick = () => selectOption(idx);
      container.appendChild(btn);
    });
  }

  function selectOption(idx) {
    selectedOption = idx;
    alert("Selected: " + polls[currentPoll].options[idx].name);
  }

  // Submit vote (student)
  function submitVote() {
    const voterName = document.getElementById("voterName").value.trim();
    if (!voterName) {
      alert("Please enter your name.");
      return;
    }
    if (selectedOption === null) {
      alert("Select an option first.");
      return;
    }
    const poll = polls[currentPoll];
    if (poll.voters.includes(currentUser)) {
      alert("You already voted.");
      return;
    }
    poll.options[selectedOption].votes++;
    poll.voters.push(currentUser);
    localStorage.setItem("polls", JSON.stringify(polls));
    document.getElementById("voteMessage").textContent = " Vote Successful!";
  }

  // View results (admin)
  function viewResults(i) {
    const poll = polls[i];
    const total = poll.options.reduce((s, o) => s + o.votes, 0);
    document.getElementById("adminPage").style.display = "none";
    document.getElementById("resultsPage").style.display = "block";
    document.getElementById("resultsQuestion").textContent = poll.question;
    const container = document.getElementById("resultsContainer");
    container.innerHTML = "";
    poll.options.forEach(opt => {
      const pct = total ? ((opt.votes / total) * 100).toFixed(1) : 0;
      container.innerHTML += `<p><b>${opt.name}</b>: ${opt.votes} votes (${pct}% )</p>`;
    });
  }

  function goBack() {
    document.getElementById("votePage").style.display = "none";
    document.getElementById("studentPage").style.display = "block";
  }

  function goHome() {
    document.getElementById("resultsPage").style.display = "none";
    document.getElementById("adminPage").style.display = "block";
    loadPolls();
  }
</script>

</body>
</html>
